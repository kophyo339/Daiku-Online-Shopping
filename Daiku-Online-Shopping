<!DOCTYPE html>
<html lang="my">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Daiku - á€¡á€½á€”á€ºá€œá€­á€¯á€„á€ºá€¸á€†á€­á€¯á€„á€º (Demo)</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daiku Online Shop</title>

<style>
  :root{--blue:#0b75c9;--green:#28a745;--orange:#ff9800}
  body{font-family: "Noto Sans Myanmar", "Segoe UI", Roboto, sans-serif; margin:0; background:#f5f7fb; color:#111}
  header{background:var(--blue); color:#fff; padding:12px 16px; display:flex; align-items:center; justify-content:space-between}
  .brand{font-weight:700}
  .nav button{background:transparent;border:0;color:#fff;cursor:pointer;font-size:14px;margin-left:10px}
  main{display:flex; gap:16px; padding:18px;}
  .sidebar{width:260px}
  .products{flex:1; display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:16px}
  .product{background:#fff;border-radius:8px;padding:12px; display:flex; flex-direction:column; gap:8px; box-shadow:0 1px 4px rgba(12,20,40,0.06)}
  .product img{height:140px; object-fit:cover; border-radius:6px; background:#eee}
  .price{font-weight:700}
  .btn{padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
  .btn-primary{background:var(--blue); color:#fff}
  .btn-buy{background:var(--green); color:#fff}
  .btn-pay{background:var(--orange); color:#fff}
  .card{background:#fff;border-radius:8px;padding:12px;box-shadow:0 1px 4px rgba(12,20,40,0.06);margin-bottom:12px}
  input[type="text"], input[type="number"], textarea{width:100%; padding:8px; border:1px solid #ddd; border-radius:6px; box-sizing:border-box}
  .preview-img{width:100%;height:120px;object-fit:cover;border-radius:6px;display:none;margin-top:8px}
  #productsEmpty{color:#666;padding:12px}
  .small{font-size:13px;color:#444}
  #chatMessages, #adminChatMessages{height:160px; overflow:auto; background:#fafafa; padding:8px; border-radius:6px; border:1px solid #eee}
  .order-item{margin-bottom:8px}
  .muted{color:#666}
  .right-col{width:360px; max-width:100%}
  .u-input{width:100%; padding:8px; border-radius:6px; border:1px solid #ddd; margin-bottom:6px; box-sizing:border-box}
  .order-block{padding:8px;border-radius:6px;border:1px solid #eee;background:#fff;margin-bottom:8px}
body{font-family:'Segoe UI', Roboto, 'Noto Sans Myanmar', sans-serif;margin:0;background:#f5f7fb;color:#222}
header{background:#0b75c9;color:#fff;padding:12px 16px;display:flex;justify-content:space-between;align-items:center}
.nav button{background:transparent;border:0;color:#fff;cursor:pointer;font-size:14px;margin-left:8px}
main{display:flex;gap:20px;padding:18px}
.sidebar{width:220px}
.products{flex:1;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px}
.product{background:#fff;border-radius:8px;padding:12px;display:flex;flex-direction:column;gap:8px}
.product img{height:140px;object-fit:cover;border-radius:6px}
.price{font-weight:700}
.btn{padding:8px 10px;border-radius:8px;border:0;cursor:pointer}
.btn-primary{background:#0b75c9;color:#fff}
.admin-form input[type='text'],.admin-form input[type='number'],.u-input{
 padding:8px;border-radius:6px;border:1px solid #ddd;width:100%;margin-bottom:6px
}
.preview-img{width:100%;height:120px;object-fit:cover;border-radius:6px;display:none;margin-top:8px}
.card{background:#fff;border-radius:8px;padding:12px;box-shadow:0 1px 4px rgba(12,20,40,0.06);margin-bottom:12px}
</style>
</head>

<body>
<header>
  <div class="brand">ğŸ”· Daiku - á€¡á€½á€”á€ºá€œá€­á€¯á€„á€ºá€¸á€†á€­á€¯á€„á€º (Demo)</div>
  <div class="nav">
    <button id="messagesBtn">á€™á€€á€ºá€†á€±á€·á€á€ºá€º</button>
    <button id="adminToggleBtn">Admin á€á€„á€ºá€™á€Šá€º</button>
    <button id="cartBtn">á€€á€á€º (<span id="cartCount">0</span>)</button>
  </div>
<div class="brand">ğŸ”· Daiku - á€¡á€½á€”á€ºá€œá€­á€¯á€„á€ºá€¸á€†á€­á€¯á€„á€º</div>
<div class="nav">
<button id="messagesBtn">á€™á€€á€ºá€†á€±á€·á€á€»á€º</button>
<button id="adminToggleBtn">Admin á€á€„á€ºá€™á€Šá€º</button>
<button id="cartBtn">á€€á€á€º (<span id="cartCount">0</span>)</button>
</div>
</header>

<main>
  <!-- LEFT SIDEBAR -->
  <aside class="sidebar">
    <div class="card">
      <div class="small">á€›á€¾á€¬á€›á€”á€º</div>
      <input id="searchInput" placeholder="á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€ºáŠ á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸" />
    </div>

    <div class="card">
      <div style="font-weight:700">á€…á€»á€±á€¸á€á€šá€ºá€€á€á€º</div>
      <div class="small">á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸: <span id="cartTotalPrice">0 Ks</span></div>
      <div id="cartItemsList" style="margin-top:8px"></div>
      <div style="display:flex; gap:8px; margin-top:8px">
        <button id="checkoutBtn" class="btn btn-primary">Checkout</button>
        <button id="clearCartBtn" class="btn">Clear</button>
      </div>
    </div>

    <div class="card">
      <div style="font-weight:700">Order History (User)</div>
      <div id="orderList" class="small">á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€›á€¾á€­á€á€±á€¸á€•á€«</div>
    </div>
  </aside>

  <!-- PRODUCTS -->
  <section class="products" id="products"></section>

  <!-- RIGHT COLUMN (Admin + Forms + Chat) -->
  <aside class="right-col">
    <!-- Admin Panel -->
    <div class="card admin" id="adminPanel" style="display:none">
      <div style="font-weight:700">Admin - á€•á€…á€¹á€…á€Šá€ºá€¸ á€‘á€Šá€·á€ºá€™á€Šá€º</div>
      <form id="adminForm" class="admin-form" style="margin-top:8px">
        <input id="pName" type="text" placeholder="á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€º" required />
        <input id="pPrice" type="number" placeholder="á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸ (Ks)" required style="margin-top:8px"/>
        <input id="pCategory" type="text" placeholder="á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸" style="margin-top:8px"/>
        <input id="pImage" type="file" accept="image/*" style="margin-top:8px"/>
        <img id="pPreview" class="preview-img" />
        <div style="margin-top:8px; display:flex; gap:8px">
          <button type="submit" class="btn btn-primary">á€‘á€Šá€·á€ºá€™á€Šá€º</button>
          <button type="button" id="adminLogout" class="btn">Admin á€‘á€½á€€á€ºá€™á€Šá€º</button>
        </div>
      </form>
    </div>

    <!-- Admin Orders (Admin only) -->
    <div class="card admin" id="adminOrders" style="display:none; margin-top:12px">
      <div style="font-weight:700">Admin - Customer Orders</div>
      <div id="adminOrderList" style="margin-top:8px"></div>
    </div>

    <!-- Admin Chat -->
    <div class="card admin" id="adminChat" style="display:none; margin-top:12px">
      <div style="font-weight:700">Admin Chat</div>
      <div id="adminChatMessages" style="margin-top:8px"></div>
      <input id="adminChatInput" placeholder="Admin á€™á€¾á€¬ á€…á€€á€¬á€¸á€›á€­á€¯á€€á€ºá€•á€«..." class="u-input" />
      <div style="display:flex; gap:8px">
        <button id="adminSendBtn" class="btn btn-primary">á€•á€­á€¯á€·á€™á€Šá€º</button>
        <button id="adminClearMessages" class="btn">Clear</button>
      </div>
    </div>

    <!-- Checkout Form (User fills) -->
    <div class="card" id="checkoutForm" style="display:none; margin-top:12px">
      <div style="font-weight:700">á€á€šá€ºá€šá€°á€á€° á€¡á€á€»á€€á€ºá€¡á€œá€€á€º</div>
      <input id="uName" placeholder="á€”á€¬á€™á€Šá€º" class="u-input" />
      <input id="uPhone" placeholder="á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º" class="u-input" />
      <input id="uAddress" placeholder="á€”á€±á€›á€•á€ºá€œá€­á€•á€ºá€…á€¬" class="u-input" />
      <input id="uAccount" placeholder="á€¡á€€á€±á€¬á€„á€·á€º (User Account)" class="u-input" />
      <div style="display:flex; gap:8px;">
        <button id="confirmOrderBtn" class="btn btn-primary">á€¡á€±á€¬á€ºá€’á€«á€¡á€á€Šá€ºá€•á€¼á€¯á€™á€Šá€º</button>
        <button id="cancelCheckout" class="btn">á€™á€œá€¯á€•á€ºá€á€±á€¬á€·</button>
      </div>
    </div>

    <!-- User Chat -->
    <div class="card" id="chatBox" style="margin-top:12px">
      <div style="font-weight:700">ğŸ“© á€…á€€á€¬á€¸á€á€¾á€€á€º (Admin â†â†’ User)</div>
      <div id="chatMessages" style="margin-top:8px"></div>
      <input id="chatInput" placeholder="á€…á€¬á€›á€­á€¯á€€á€ºá€•á€«..." class="u-input" />
      <div style="display:flex; gap:8px">
        <button id="sendMsgBtn" class="btn btn-primary">á€™á€€á€ºá€†á€±á€·á€á€»á€º á€•á€­á€¯á€·á€™á€Šá€º</button>
        <button id="clearChatBtn" class="btn">Clear</button>
      </div>
      <div class="muted" style="margin-top:6px; font-size:12px">
        á€¡á€±á€¬á€ºá€’á€«á€”á€¾á€„á€·á€º á€•á€á€ºá€á€€á€ºá€á€±á€¬ á€…á€€á€¬á€¸á€™á€»á€¬á€¸á€›á€¾á€­á€•á€«á€€ á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€« â€” á€¡á€±á€¬á€ºá€’á€« ID á€€á€­á€¯ auto attach á€œá€¯á€•á€ºá€•á€±á€¸á€•á€«á€œá€­á€™á€·á€ºá€™á€šá€ºá‹
      </div>
    </div>
  </aside>

<!-- LEFT SIDEBAR -->
<aside class="sidebar">

<div class="card">
<b>ğŸ” á€›á€¾á€¬á€›á€”á€º</b>
<input id="searchInput" placeholder="á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€º / á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸">
</div>

<div class="card">
<div style="font-weight:700">ğŸ›’ á€…á€»á€±á€¸á€á€šá€ºá€€á€á€º</div>
<div>á€…á€¯á€…á€¯á€•á€±á€«á€„á€ºá€¸: <span id="cartTotalPrice">0</span></div>
<button id="checkoutBtn" class="btn btn-primary" style="margin-top:8px">á€˜á€á€ºá€á€»á€ºá€á€»á€º</button>
</div>

<!-- Checkout Form -->
<div class="card" id="checkoutForm" style="display:none">
<b>ğŸ§¾ á€á€šá€ºá€šá€°á€á€° á€¡á€á€»á€€á€ºá€¡á€œá€€á€º</b>
<input id="uName" class="u-input" placeholder="á€”á€¬á€™á€Šá€º">
<input id="uPhone" class="u-input" placeholder="á€–á€¯á€”á€ºá€¸á€”á€¶á€•á€«á€á€º">
<input id="uAddress" class="u-input" placeholder="á€”á€±á€›á€•á€ºá€œá€­á€•á€ºá€…á€¬">
<input id="uAccount" class="u-input" placeholder="User Account">
<button id="confirmOrderBtn" class="btn btn-primary">á€¡á€±á€¬á€ºá€’á€« á€á€„á€ºá€™á€Šá€º</button>
</div>

<div class="card">
<b>ğŸ“¦ Order History</b>
<div id="orderList">á€™á€›á€¾á€­á€á€±á€¸á€•á€«</div>
</div>

<!-- Payment Box -->
<div class="card">
<b>ğŸ’° Payment Methods</b>

<div style="margin-top:10px">
  <div><b>KPay</b></div>
  <div id="kpayNumber">09 940790449</div>
  <button class="btn btn-primary" onclick="copyNumber('kpayNumber')">Copy</button>
</div>

<hr style="margin:12px 0">

<div>
  <div><b>WavePay</b></div>
  <div id="waveNumber">09 954204473</div>
  <button class="btn btn-primary" onclick="copyNumber('waveNumber')">Copy</button>
</div>
</div>

</aside>

<!-- CENTER PRODUCTS -->
<section class="products" id="products"></section>

<!-- RIGHT PANEL -->
<aside style="width:360px;max-width:100%">

<!-- Admin Product Add -->
<div class="card admin" id="adminPanel" style="display:none">
<b>Admin - á€•á€…á€¹á€…á€Šá€ºá€¸á€‘á€Šá€·á€ºá€™á€Šá€º</b>
<form id="adminForm" class="admin-form">
<input id="pName" type="text" placeholder="á€•á€…á€¹á€…á€Šá€ºá€¸á€¡á€™á€Šá€º" required>
<input id="pPrice" type="number" placeholder="á€ˆá€±á€¸á€”á€¾á€¯á€”á€ºá€¸" required>
<input id="pCategory" type="text" placeholder="á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸">
<input id="pImage" type="file" accept="image/*">
<img id="pPreview" class="preview-img">
<div style="margin-top:8px;display:flex;gap:8px">
<button type="submit" class="btn btn-primary">á€‘á€Šá€·á€ºá€™á€Šá€º</button>
<button type="button" id="adminLogout" class="btn">á€‘á€½á€€á€ºá€™á€Šá€º</button>
</div>
</form>
</div>

<!-- Admin Orders -->
<div class="card admin" id="adminOrders" style="display:none">
<b>Customer Orders</b>
<div id="adminOrderList">á€™á€›á€¾á€­á€á€±á€¸á€•á€«</div>
</div>

<!-- Admin Chat -->
<div class="card admin" id="adminChat" style="display:none">
<b>Admin Chat</b>
<div id="adminChatMessages" style="height:150px;overflow:auto;background:#f7f7f7;border:1px solid #eee;padding:6px;border-radius:6px;margin-bottom:8px"></div>
<input id="adminChatInput" class="u-input" placeholder="Admin message">
<button id="adminSendBtn" class="btn btn-primary">á€•á€­á€¯á€·á€™á€Šá€º</button>
</div>

<!-- User Chat -->
<div class="card" id="chatBox">
<b>ğŸ’¬ á€…á€€á€¬á€¸á€•á€¼á€±á€¬á€›á€”á€º</b>
<div id="chatMessages" style="height:150px;overflow:auto;background:#f5f5f5;border:1px solid #ddd;padding:6px;border-radius:6px;margin-bottom:8px"></div>
<input id="chatInput" class="u-input" placeholder="Message...">
<button id="sendMsgBtn" class="btn btn-primary">á€•á€­á€¯á€·á€™á€Šá€º</button>
</div>

</aside>
</main>

<script>
/* ---------------------------
   Demo eCommerce App (Client-side, localStorage)
   Features:
   - Products (admin add)
   - Cart (add/remove)
   - Checkout with user info -> order saved (orderID, time)
   - Admin-only order viewer
   - User <-> Admin chat (messages stored), messages can include orderID
   ---------------------------*/

/* ---------- Constants & State ---------- */
const ADMIN_PASSWORD = '1234';

let products = JSON.parse(localStorage.getItem('demo_products') || '[]');
let cart = JSON.parse(localStorage.getItem('demo_cart') || '[]');
let orders = JSON.parse(localStorage.getItem('demo_orders') || '[]'); // array of order objects
let messages = JSON.parse(localStorage.getItem('demo_messages') || '[]'); // {sender, text, time, orderID?}
let lastUserOrderID = localStorage.getItem('demo_last_order') || null;

const productsEl = document.getElementById('products');
const cartCount = document.getElementById('cartCount');
const cartTotalPrice = document.getElementById('cartTotalPrice');
const cartItemsList = document.getElementById('cartItemsList');
const adminPanel = document.getElementById('adminPanel');
const adminToggleBtn = document.getElementById('adminToggleBtn');
const adminForm = document.getElementById('adminForm');
const pPreview = document.getElementById('pPreview');
const pImage = document.getElementById('pImage');
const searchInput = document.getElementById('searchInput');
const orderList = document.getElementById('orderList');
const checkoutBtn = document.getElementById('checkoutBtn');
const checkoutForm = document.getElementById('checkoutForm');
const confirmOrderBtn = document.getElementById('confirmOrderBtn');
const cancelCheckout = document.getElementById('cancelCheckout');
const adminOrdersPanel = document.getElementById('adminOrders');
const adminOrderList = document.getElementById('adminOrderList');
const adminChat = document.getElementById('adminChat');
const adminChatMessages = document.getElementById('adminChatMessages');
const adminChatInput = document.getElementById('adminChatInput');
const adminSendBtn = document.getElementById('adminSendBtn');
const messagesBtn = document.getElementById('messagesBtn');
const chatBox = document.getElementById('chatBox');
const chatMessages = document.getElementById('chatMessages');
const chatInput = document.getElementById('chatInput');
const sendMsgBtn = document.getElementById('sendMsgBtn');
const adminLogout = document.getElementById('adminLogout');
const cartBtn = document.getElementById('cartBtn');
const clearCartBtn = document.getElementById('clearCartBtn');
const clearChatBtn = document.getElementById('clearChatBtn');
const adminClearMessages = document.getElementById('adminClearMessages');
const adminOrderListElem = document.getElementById('adminOrderList');

function saveProducts(){ localStorage.setItem('demo_products', JSON.stringify(products)); }
function saveCart(){ localStorage.setItem('demo_cart', JSON.stringify(cart)); renderCartSummary(); }
function saveOrders(){ localStorage.setItem('demo_orders', JSON.stringify(orders)); renderOrders(); renderAdminOrders(); }
function saveMessages(){ localStorage.setItem('demo_messages', JSON.stringify(messages)); renderChat(); renderAdminChat(); }

/* ---------- Utilities ---------- */
function formatPrice(n){ return Number(n).toLocaleString() + ' Ks'; }
function nowString(){ return new Date().toLocaleString(); }

/* ---------- Renderers ---------- */
/* ===== DATA ===== */
const ADMIN_PASSWORD = "1234";

let products = JSON.parse(localStorage.getItem("demo_products") || "[]");
let cart = JSON.parse(localStorage.getItem("demo_cart") || "[]");
let orders = JSON.parse(localStorage.getItem("demo_orders") || "[]");
let messages = JSON.parse(localStorage.getItem("demo_messages") || "[]");

function saveProducts(){localStorage.setItem("demo_products",JSON.stringify(products));}
function saveCart(){localStorage.setItem("demo_cart",JSON.stringify(cart)); renderCartSummary();}
function saveOrders(){localStorage.setItem("demo_orders",JSON.stringify(orders)); renderOrders();}
function saveMessages(){localStorage.setItem("demo_messages",JSON.stringify(messages));}

/* ===== ELEMENTS ===== */
const productsEl = document.getElementById("products");
const searchInput = document.getElementById("searchInput");
const cartCount = document.getElementById("cartCount");
const cartTotalPrice = document.getElementById("cartTotalPrice");
const orderList = document.getElementById("orderList");
const adminOrdersPanel = document.getElementById("adminOrders");
const adminOrderList = document.getElementById("adminOrderList");
const adminChat = document.getElementById("adminChat");

/* ===== PRICE FORMAT ===== */
function formatPrice(n){
    return Number(n).toLocaleString()+" Ks";
}

/* ===== PRODUCT RENDER ===== */
function renderProducts(){
  const q = (searchInput.value || '').toLowerCase();
  productsEl.innerHTML = '';
  if(products.length===0){ productsEl.innerHTML = "<div id='productsEmpty'>á€•á€…á€¹á€…á€Šá€ºá€¸ á€™á€›á€¾á€­á€á€±á€¸á€•á€« â€” Admin á€¡á€”á€±á€”á€²á€·á€‘á€Šá€·á€ºá€•á€«</div>"; return; }
  products.filter(p => !q || p.name.toLowerCase().includes(q) || (p.category||'').toLowerCase().includes(q))
    .forEach((p, idx) => {
      const el = document.createElement('div'); el.className = 'product card';
      el.innerHTML = `
        <img src="${p.image||''}" alt="${p.name}">
        <div style="font-weight:700">${p.name}</div>
        <div class="price">${formatPrice(p.price)}</div>
        <div class="muted">${p.category || ''}</div>
        <div style="display:flex; gap:6px; margin-top:6px">
          <button class="btn btn-primary" data-add="${idx}">á€€á€á€ºá€‘á€Šá€·á€ºá€™á€Šá€º</button>
          <button class="btn btn-buy" data-buy="${idx}">á€šá€á€¯á€•á€±á€¸á€›á€”á€º</button>
          <button class="btn btn-pay" data-kpay="${idx}">KPay</button>
          <button class="btn btn-pay" data-wavepay="${idx}">WavePay</button>
        </div>
      `;
      productsEl.appendChild(el);
  });
    const q = searchInput.value.toLowerCase();
    productsEl.innerHTML = "";

    products.filter(p => !q || p.name.toLowerCase().includes(q))
    .forEach((p,idx)=>{
        const el = document.createElement("div");
        el.className = "product card";
        el.innerHTML = `
            <img src="${p.image}">
            <div><b>${p.name}</b></div>
            <div class="price">${formatPrice(p.price)}</div>
            <button class="btn btn-primary" data-add="${idx}">á€€á€á€ºá€‘á€Šá€·á€ºá€™á€Šá€º</button>
        `;
        productsEl.appendChild(el);
    });
}

/* ===== CART ===== */
productsEl.addEventListener("click", e=>{
    if(e.target.dataset.add){
        const p = products[e.target.dataset.add];
        const item = cart.find(c=>c.name===p.name);
        if(item) item.qty++;
        else cart.push({...p, qty:1});
        saveCart();
    }
});
function renderCartSummary(){
  cartCount.innerText = cart.reduce((s,i)=>s+i.qty,0);
  const total = cart.reduce((s,i)=>s+i.price*i.qty,0);
  cartTotalPrice.innerText = formatPrice(total);
  // cart items list
  cartItemsList.innerHTML = '';
  if(cart.length===0){ cartItemsList.innerHTML = '<div class="muted">Cart á€¡á€œá€½á€¾á€á€º</div>'; return; }
  cart.forEach((c, i) => {
    const div = document.createElement('div');
    div.className = 'order-block';
    div.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div><b>${c.name}</b><div class="muted">${formatPrice(c.price)}</div></div>
        <div>
          <button class="btn" data-dec="${i}">-</button>
          <span style="margin:0 6px">${c.qty}</span>
          <button class="btn" data-inc="${i}">+</button>
        </div>
      </div>
    `;
    cartItemsList.appendChild(div);
  });
    cartCount.textContent = cart.reduce((s,i)=>s+i.qty,0);
    cartTotalPrice.textContent = formatPrice(cart.reduce((s,i)=>s+i.qty*i.price,0));
}

/* ===== USER ORDERS ===== */
function renderOrders(){
  // User-facing order history
  if(orders.length===0){ orderList.innerText = 'á€™á€¾á€á€ºá€á€™á€ºá€¸á€™á€›á€¾á€­á€á€±á€¸á€•á€«'; return; }
  orderList.innerHTML = '';
  orders.slice().reverse().forEach(o=>{
    const div = document.createElement('div');
    div.className = 'order-block';
    div.innerHTML = `
      <div><b>Order ID:</b> ${o.orderID}</div>
      <div><b>Time:</b> ${o.time}</div>
      <div><b>Customer:</b> ${o.user.name} (${o.user.phone})</div>
      <div class="muted">Items: ${o.items.map(it=>`${it.name} x${it.qty}`).join(', ')}</div>
    `;
    orderList.appendChild(div);
  });
    if(orders.length===0){orderList.textContent="á€™á€›á€¾á€­á€á€±á€¸á€•á€«"; return;}
    orderList.innerHTML = orders.map(o=>
        `<div><b>${o.orderID}</b> - ${o.user.name}</div>`
    ).join("");
}

/* ===== ADMIN ORDERS ===== */
function renderAdminOrders(){
  adminOrderList.innerHTML = '';
  if(orders.length===0){ adminOrderList.innerText = 'Order á€™á€›á€¾á€­á€á€±á€¸á€•á€«'; return; }
  orders.slice().reverse().forEach(o=>{
    const div = document.createElement('div');
    div.className = 'order-block';
    div.innerHTML = `
      <div><b>Order ID:</b> ${o.orderID}</div>
      <div><b>Time:</b> ${o.time}</div>
      <div><b>Customer:</b> ${o.user.name} (${o.user.phone})</div>
      <div><b>Address:</b> ${o.user.addr}</div>
      <div><b>Account:</b> ${o.user.acc || '-'}</div>
      <div style="margin-top:6px"><b>Items:</b></div>
      <div class="muted">${o.items.map(it=>`- ${it.name} x${it.qty} (${formatPrice(it.price)})`).join('<br>')}</div>
      <div style="margin-top:8px; display:flex; gap:6px">
        <button class="btn btn-primary" data-chat="${o.orderID}">Chat</button>
        <button class="btn" data-mark="${o.orderID}">Mark as Processed</button>
      </div>
    `;
    adminOrderList.appendChild(div);
  });
}

/* Chat render */
function renderChat(){
  chatMessages.innerHTML = messages.map(m=>{
    const idInfo = m.orderID ? ` <span class="muted">[Order:${m.orderID}]</span>` : '';
    return `<div><b>${m.sender}</b>${idInfo}: ${m.text} <div class="muted" style="font-size:12px">${m.time}</div></div>`;
  }).join('<hr style="border:none;border-top:1px solid #eee;margin:6px 0">');
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

function renderAdminChat(){
  adminChatMessages.innerHTML = messages.map(m=>{
    const idInfo = m.orderID ? ` <span class="muted">[Order:${m.orderID}]</span>` : '';
    return `<div><b>${m.sender}</b>${idInfo}: ${m.text} <div class="muted" style="font-size:12px">${m.time}</div></div>`;
  }).join('<hr style="border:none;border-top:1px solid #eee;margin:6px 0">');
  adminChatMessages.scrollTop = adminChatMessages.scrollHeight;
    adminOrderList.innerHTML = "";
    if(orders.length===0){ adminOrderList.innerHTML="á€™á€›á€¾á€­á€á€±á€¸á€•á€«"; return;}

    orders.forEach(o=>{
        const div = document.createElement("div");
        div.style.borderBottom="1px solid #eee";
        div.style.marginBottom="8px";
        div.innerHTML = `
            <div><b>OrderID:</b> ${o.orderID}</div>
            <div><b>Time:</b> ${o.time}</div>
            <div><b>Customer:</b> ${o.user.name} (${o.user.phone})</div>
            <div><b>Address:</b> ${o.user.addr}</div>
            <div><b>Account:</b> ${o.user.acc}</div>
            <b>Items:</b>
            ${o.items.map(i=>`<div>- ${i.name} x ${i.qty} (${formatPrice(i.price)})</div>`).join("")}
        `;
        adminOrderList.appendChild(div);
    });
}

/* ---------- Event wiring ---------- */

/* Products actions: add to cart / buy now / pay buttons */
productsEl.addEventListener('click', (e) => {
  if(e.target.dataset.add !== undefined){
    const idx = Number(e.target.dataset.add);
    const p = products[idx];
    const cartItem = cart.find(c => c.name === p.name);
    if(cartItem) cartItem.qty++;
    else cart.push({...p, qty:1});
    saveCart();
    alert(`${p.name} á€€á€­á€¯ á€€á€á€ºá€‘á€Šá€·á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®`);
  }
  if(e.target.dataset.buy !== undefined){
    const idx = Number(e.target.dataset.buy);
    const p = products[idx];
    // create a one-item order (prompt user for info)
    cart = [{...p, qty:1}];
    saveCart();
    checkoutForm.style.display = 'block';
  }
  if(e.target.dataset.kpay !== undefined){
    const idx = Number(e.target.dataset.kpay);
    const p = products[idx];
    alert(`KPay á€–á€¼á€„á€·á€º ${p.name} á€€á€­á€¯ á€…á€®á€…á€‰á€ºá€‘á€¬á€¸á€•á€« (Demo)`);
  }
  if(e.target.dataset.wavepay !== undefined){
    const idx = Number(e.target.dataset.wavepay);
    const p = products[idx];
    alert(`WavePay á€–á€¼á€„á€·á€º ${p.name} á€€á€­á€¯ á€…á€®á€…á€‰á€ºá€‘á€¬á€¸á€•á€« (Demo)`);
  }
/* ===== CHECKOUT FORM ===== */
document.getElementById("checkoutBtn").addEventListener("click", ()=>{
    if(cart.length===0) return alert("Cart á€¡á€œá€½á€á€º");
    document.getElementById("checkoutForm").style.display="block";
});

/* Cart quantity controls */
cartItemsList.addEventListener('click', (e) => {
  if(e.target.dataset.inc !== undefined){
    const i = Number(e.target.dataset.inc); cart[i].qty++; saveCart();
  }
  if(e.target.dataset.dec !== undefined){
    const i = Number(e.target.dataset.dec);
    cart[i].qty--; if(cart[i].qty <= 0) cart.splice(i,1);
    saveCart();
  }
});

/* Clear cart */
clearCartBtn.addEventListener('click', () => {
  if(!confirm('Cart á€€á€­á€¯á€–á€»á€€á€ºá€™á€¾á€¬ á€á€€á€šá€ºá€œá€¬á€¸?')) return;
  cart = []; saveCart();
});

/* Checkout flow */
checkoutBtn.addEventListener('click', () => {
  if(cart.length === 0){ alert('Cart á€¡á€œá€½á€á€ºá€•á€«'); return; }
  checkoutForm.style.display = 'block';
});

cancelCheckout.addEventListener('click', () => {
  checkoutForm.style.display = 'none';
});
document.getElementById("confirmOrderBtn").addEventListener("click", ()=>{
    const name=document.getElementById("uName").value;
    const phone=document.getElementById("uPhone").value;
    const addr=document.getElementById("uAddress").value;
    const acc=document.getElementById("uAccount").value;

/* Confirm Order -> save order with details */
confirmOrderBtn.addEventListener('click', () => {
  const name = document.getElementById('uName').value.trim();
  const phone = document.getElementById('uPhone').value.trim();
  const addr = document.getElementById('uAddress').value.trim();
  const acc = document.getElementById('uAccount').value.trim();
    if(!name||!phone||!addr) return alert("User Info á€™á€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€•á€«");

  if(!name || !phone || !addr){ alert('á€”á€¬á€™á€Šá€º / á€–á€¯á€”á€ºá€¸ / á€œá€­á€•á€ºá€…á€¬ á€•á€¼á€Šá€·á€ºá€…á€¯á€¶á€…á€½á€¬ á€–á€¼á€Šá€·á€ºá€•á€«'); return; }
    const orderID = "OD" + Date.now();
    const orderTime = new Date().toLocaleString();

  const orderID = 'OD' + Date.now();
  const orderTime = nowString();

  const order = {
    orderID,
    time: orderTime,
    user: { name, phone, addr, acc },
    items: JSON.parse(JSON.stringify(cart)) // deep copy
  };

  orders.push(order);
  saveOrders();

  // keep last user order id for user chat context
  lastUserOrderID = orderID;
  localStorage.setItem('demo_last_order', lastUserOrderID);

  // clear cart
  cart = []; saveCart();

  checkoutForm.style.display = 'none';
  document.getElementById('uName').value = '';
  document.getElementById('uPhone').value = '';
  document.getElementById('uAddress').value = '';
  document.getElementById('uAccount').value = '';

  alert(`Order á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€® (Order ID: ${orderID})\nAdmin á€™á€¾ á€†á€€á€ºá€á€½á€šá€ºá€á€½á€¬á€¸á€•á€«á€á€Šá€ºá‹`);
});
    orders.push({
        orderID,
        time: orderTime,
        user:{name,phone,addr,acc},
        items:[...cart]
    });

/* Admin login toggle */
adminToggleBtn.addEventListener('click', () => {
  const pass = prompt('Admin Password á€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€•á€«');
  if(pass === ADMIN_PASSWORD){
    adminPanel.style.display = 'block';
    adminOrdersPanel.style.display = 'block';
    adminChat.style.display = 'block';
    adminToggleBtn.innerText = 'Admin: Logged In';
    renderAdminOrders();
    renderAdminChat();
  } else {
    alert('Password á€™á€™á€¾á€”á€ºá€•á€«');
  }
});

/* Admin logout */
adminLogout.addEventListener('click', () => {
  adminPanel.style.display = 'none';
  adminOrdersPanel.style.display = 'none';
  adminChat.style.display = 'none';
  adminToggleBtn.innerText = 'Admin á€á€„á€ºá€™á€Šá€º';
});

/* Admin: add product (with image preview) */
pImage.addEventListener('change', () => {
  const f = pImage.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = e => { pPreview.src = e.target.result; pPreview.style.display = 'block'; };
  reader.readAsDataURL(f);
});

adminForm.addEventListener('submit', (e) => {
  e.preventDefault();
  const newP = {
    name: document.getElementById('pName').value || 'Unnamed',
    price: Number(document.getElementById('pPrice').value) || 0,
    category: document.getElementById('pCategory').value || '',
    image: pPreview.src || ''
  };
  products.unshift(newP);
  saveProducts();
  renderProducts();
  adminForm.reset();
  pPreview.style.display = 'none';
  alert('á€•á€…á€¹á€…á€Šá€ºá€¸á€‘á€Šá€·á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®');
});

/* Admin order list actions: Chat / Mark */
adminOrderList.addEventListener('click', (e) => {
  if(e.target.dataset.chat){
    const oid = e.target.dataset.chat;
    // Show admin chat and prefill placeholder with orderID
    adminChat.style.display = 'block';
    adminChatInput.placeholder = `Reply about Order ${oid} ...`;
    adminChatInput.dataset.order = oid; // attach order context for admin replies
    adminChatInput.focus();
  }
  if(e.target.dataset.mark){
    const oid = e.target.dataset.mark;
    if(!confirm('Mark this order as processed?')) return;
    // for demo, just remove from orders (or you could set status)
    orders = orders.filter(o => o.orderID !== oid);
    cart=[];
    saveCart();
saveOrders();
    alert('Order marked processed (removed from list in demo).');
  }
});

/* Admin send message */
adminSendBtn.addEventListener('click', () => {
  const txt = adminChatInput.value.trim();
  if(!txt) return;
  const orderID = adminChatInput.dataset.order || null;
  const msg = { sender: 'Admin', text: txt, time: nowString(), orderID };
  messages.push(msg); saveMessages();
  adminChatInput.value = '';
  adminChatInput.dataset.order = ''; adminChatInput.placeholder = 'Admin á€™á€¾á€¬ á€…á€€á€¬á€¸á€›á€­á€¯á€€á€ºá€•á€«...';
});

/* User messages */
sendMsgBtn.addEventListener('click', () => {
  const txt = chatInput.value.trim();
  if(!txt) return;
  const orderID = lastUserOrderID; // auto attach last order for user convenience
  const msg = { sender: 'User', text: txt, time: nowString(), orderID };
  messages.push(msg); saveMessages();
  chatInput.value = '';
  alert('Message á€•á€­á€¯á€·á€•á€¼á€®á€¸á€•á€«á€•á€¼á€® â€” Admin á€á€­á€¯á€· á€•á€¼á€”á€ºá€œá€Šá€ºá€†á€€á€ºá€á€½á€šá€ºá€™á€Šá€º');
});

/* Messages UI toggles */
messagesBtn.addEventListener('click', () => {
  chatBox.scrollIntoView({behavior:'smooth'});
});

/* Clear chat messages (user) */
clearChatBtn.addEventListener('click', () => {
  if(!confirm('Messages á€™á€»á€¬á€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸ á€–á€»á€€á€ºá€™á€¾á€¬á€œá€¬á€¸?')) return;
  messages = []; saveMessages();
});
    alert("Order á€á€„á€ºá€•á€¼á€®á€¸á€•á€«á€•á€¼á€®");

/* Admin clear messages */
adminClearMessages.addEventListener('click', () => {
  if(!confirm('Messages á€™á€»á€¬á€¸á€¡á€¬á€¸á€œá€¯á€¶á€¸ á€–á€»á€€á€ºá€™á€¾á€¬á€œá€¬á€¸?')) return;
  messages = []; saveMessages();
    document.getElementById("checkoutForm").style.display="none";
});

/* Cart button toggles view */
cartBtn.addEventListener('click', () => {
  window.scrollTo({ top: 0, behavior: 'smooth' });
  // simple: highlight the sidebar (user can see cart)
});
/* ===== ADMIN LOGIN ===== */
adminToggleBtn.onclick = ()=>{
    const pass = prompt("Admin Password?");
    if(pass===ADMIN_PASSWORD){
        adminPanel.style.display="block";
        adminOrdersPanel.style.display="block";
        adminChat.style.display="block";
        renderAdminOrders();
        renderAdminChat();
        adminToggleBtn.innerText="Admin âœ”";
    } else {
        alert("Password á€™á€™á€¾á€”á€ºá€•á€«");
    }
};
document.getElementById("adminLogout").onclick=()=>{
    adminPanel.style.display="none";
    adminOrdersPanel.style.display="none";
    adminChat.style.display="none";
    adminToggleBtn.innerText="Admin á€á€„á€ºá€™á€Šá€º";
};

/* ===== ADMIN ADD PRODUCT ===== */
const pImage=document.getElementById("pImage");
const pPreview=document.getElementById("pPreview");

pImage.onchange=()=>{
    const file=pImage.files[0];
    if(!file)return;
    const reader=new FileReader();
    reader.onload=e=>{
        pPreview.src=e.target.result;
        pPreview.style.display="block";
    }
    reader.readAsDataURL(file);
};

adminForm.onsubmit=(e)=>{
    e.preventDefault();
    products.unshift({
        name:pName.value,
        price:Number(pPrice.value),
        category:pCategory.value,
        image:pPreview.src
    });
    saveProducts();
    renderProducts();
    adminForm.reset();
    pPreview.style.display="none";
    alert("á€‘á€Šá€·á€ºá€•á€¼á€®á€¸");
};

/* ===== USER CHAT ===== */
function renderChat(){
    chatMessages.innerHTML = messages.map(m=>`<div><b>${m.sender}:</b> ${m.text}</div>`).join("");
}
sendMsgBtn.onclick=()=>{
    if(!chatInput.value) return;
    messages.push({sender:"User", text:chatInput.value});
    saveMessages();
    renderChat();
    renderAdminChat();
    chatInput.value="";
};

/* Marking processed via adminOrderList (handled above) */
/* ===== ADMIN CHAT ===== */
function renderAdminChat(){
    adminChatMessages.innerHTML = messages.map(m=>`<div><b>${m.sender}:</b> ${m.text}</div>`).join("");
}
adminSendBtn.onclick=()=>{
    const t=document.getElementById("adminChatInput").value;
    if(!t)return;
    messages.push({sender:"Admin", text:t});
    saveMessages();
    renderChat();
    renderAdminChat();
    adminChatInput.value="";
};

/* Misc: mark item removal etc. */
adminOrderListElem.addEventListener('click', (e) => {
  // delegations handled earlier
});
/* ===== SEARCH ===== */
searchInput.oninput = renderProducts;

/* Search input */
searchInput.addEventListener('input', renderProducts);
/* ===== COPY NUMBER ===== */
function copyNumber(id){
  const t = document.getElementById(id).innerText;
  navigator.clipboard.writeText(t).then(()=>alert("Copied: "+t));
}

/* Initial render */
/* ===== INITIAL LOAD ===== */
renderProducts();
renderCartSummary();
renderOrders();
renderChat();
renderAdminChat();

/* Save initial state if not present (optional demo seed) */
if(products.length === 0){
  products = [
    { name: 'á€™á€®á€¸á€–á€­á€¯á€á€»á€±á€¬á€„á€º á€…á€¬á€¸á€•á€½á€²', price: 12000, category: 'á€™á€€á€¼á€Šá€ºá€·', image: '' },
    { name: 'Daiku T-Shirt', price: 8000, category: 'á€¡á€á€á€ºá€¡á€…á€¬á€¸', image: '' }
  ];
  saveProducts();
  renderProducts();
}

</script>

</body>
</html>
